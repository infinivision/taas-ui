(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6765"],{VGKh:function(t,e,a){"use strict";var n={name:"GlobalStatus",props:["item"]},s=a("KHd+"),i=Object(s.a)(n,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.item.statusDangerous?[a("el-tag",{attrs:{type:"danger"}},[t._v(t._s(t._f("globalStatus")(t.item.status)))])]:t.item.statusWarning?[a("el-tag",{attrs:{type:"warning"}},[t._v(t._s(t._f("globalStatus")(t.item.status)))])]:t.item.statusSuccess?[a("el-tag",{attrs:{type:"success"}},[t._v(t._s(t._f("globalStatus")(t.item.status)))])]:[a("el-tag",{attrs:{type:"info"}},[t._v(t._s(t._f("globalStatus")(t.item.status)))])]],2)},[],!1,null,"06ccc42c",null);e.a=i.exports},"gH+a":function(t,e,a){"use strict";var n={name:"BranchStatus",props:["item"]},s=a("KHd+"),i=Object(s.a)(n,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.item.statusDangerous||t.item.statusWarning?[a("el-tag",{staticStyle:{color:"white"},attrs:{type:"info"}},[t._v(t._s(t._f("branchStatus")(t.item.status)))])]:[a("el-tag",{attrs:{type:"info"}},[t._v(t._s(t._f("branchStatus")(t.item.status)))])]],2)},[],!1,null,"2f01256c",null);e.a=i.exports},ghnh:function(t,e,a){"use strict";a.r(e);var n=a("pr5Q"),s=a("hZMg"),i=a("7Qib"),r=a("JDVc"),l=a("P2sY"),o=a.n(l),u=(a("jUE0"),{bind:function(t,e){t.addEventListener("click",function(a){var n=o()({},e.value),s=o()({ele:t,type:"hit",color:"rgba(0, 0, 0, 0.15)"},n),i=s.ele;if(i){i.style.position="relative",i.style.overflow="hidden";var r=i.getBoundingClientRect(),l=i.querySelector(".waves-ripple");switch(l?l.className="waves-ripple":((l=document.createElement("span")).className="waves-ripple",l.style.height=l.style.width=Math.max(r.width,r.height)+"px",i.appendChild(l)),s.type){case"center":l.style.top=r.height/2-l.offsetHeight/2+"px",l.style.left=r.width/2-l.offsetWidth/2+"px";break;default:l.style.top=a.pageY-r.top-l.offsetHeight/2-document.body.scrollTop+"px",l.style.left=a.pageX-r.left-l.offsetWidth/2-document.body.scrollLeft+"px"}return l.style.backgroundColor=s.color,l.className="waves-ripple z-active",!1}},!1)}}),c=function(t){t.directive("waves",u)};window.Vue&&(window.waves=u,Vue.use(c)),u.install=c;var d=u,h=a("j6lA"),f=a("VGKh"),g=a("gH+a"),p={name:"activeIndex",directives:{waves:d},data:function(){return{listQuery:{page:1,size:10,name:void 0,status:void 0,fid:void 0},dataList:[],fragmentList:[],listLoading:!0,pageInfo:{totalSize:void 0,lastId:void 0,lastIdList:[{page:1,lastId:null}]},globalStatusConstant:r.g,actionConstant:r.b}},components:{GlobalStatus:f.a,BranchStatus:g.a},created:function(){this.init()},watch:{$route:function(t,e){"activeIndex"!==t.name&&this.$destroy()}},methods:{init:function(){var t=this;this.listQuery.fid=this.$route.query.fid,s.a().then(function(e){t.fragmentList=e||[],t.listLoading=!1}).catch(function(){t.listLoading=!1}),this.listQuery.fid&&this.handleFilter()},handleFilter:function(){this.listLoading=!0,this.listQuery.name=void 0,this.listQuery.status=void 0,this.getList()},getList:function(t){this.listLoading=!0;var e=this,a=Object(i.a)(this.listQuery);a.id=t||"",n.c(a).then(function(t){e.listLoading=!1,e.dataList=Object(h.b)(t);var a=e._getLastId();if(a){var n=e.listQuery.page+1;if(!e._getLastIdByPage(n)){var s={page:n,lastId:a};e.pageInfo.lastIdList.push(s)}}}).catch(function(){e.listLoading=!1})},handleSearch:function(){this.getList()},handleSizeChange:function(t){this.listQuery.size=t,this.pageInfo.lastIdList=[{page:1,lastId:null}],this.getList()},handleCurrentChange:function(t){var e=this;if(t>this.pageInfo.lastIdList.length)this.$nextTick(function(){e.listQuery.page=e.pageInfo.lastIdList.length});else{var a=this._getLastIdByPage(t);this.getList(a)}},handleToggleBranch:function(t){var e=t.branchOpen;this.$refs.dataTable.toggleRowExpansion(t,!e),t.branchOpen=!t.branchOpen},handleShow:function(t){this.$router.push({path:"/active/show",query:{id:t.id,fid:this.listQuery.fid}})},handleRollback:function(t){var e=this,a=t.id;this.$confirm("是否回滚该事务？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e._doRollbackItem(a)}).catch(function(){})},_doRollbackItem:function(t){var e=this;t&&this.listQuery.fid&&n.d(this.listQuery.fid,t).then(function(){e.$message({type:"success",message:"回滚成功!"}),setTimeout(function(){e.getList()},2e3)})},handleSubmit:function(t){var e=this,a=t.id;this.$confirm("是否提交事务？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e._doSubmitItem(a)}).catch(function(){})},_doSubmitItem:function(t){var e=this;t&&this.listQuery.fid&&n.a(this.listQuery.fid,t).then(function(){e.$message({type:"success",message:"提交成功!"}),setTimeout(function(){e.getList()},2e3)})},tableDangerousClassName:function(t){var e=t.row;t.rowIndex;return e.statusDangerous?"danger-row":e.statusWarning?"warning-row":""},_getLastId:function(){var t=null,e=this.dataList.length;e===this.listQuery.size&&(t=this.dataList[e-1].id);return t},_getLastIdByPage:function(t){for(var e=null,a=0,n=this.pageInfo.lastIdList.length;a<n;a++){var s=this.pageInfo.lastIdList[a];if(s.page===t){e=s.lastId;break}}return e}}},m=a("KHd+"),b=Object(m.a)(p,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"filter-container"},[a("el-select",{staticClass:"filter-item",attrs:{filterable:"",placeholder:"请选择分片进行查询"},on:{change:t.handleFilter},model:{value:t.listQuery.fid,callback:function(e){t.$set(t.listQuery,"fid",t._n(e))},expression:"listQuery.fid"}},t._l(t.fragmentList,function(t,e){return a("el-option",{key:t.id,attrs:{label:t.id,value:t.id}})}),1),t._v(" "),t.listQuery.fid?[a("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{"prefix-icon":"el-icon-search",clearable:"",placeholder:"请输入事务名称"},model:{value:t.listQuery.name,callback:function(e){t.$set(t.listQuery,"name",e)},expression:"listQuery.name"}}),t._v(" "),a("el-select",{staticClass:"filter-item",staticStyle:{width:"250px"},attrs:{clearable:"",placeholder:"请选择状态"},model:{value:t.listQuery.status,callback:function(e){t.$set(t.listQuery,"status",e)},expression:"listQuery.status"}},t._l(t.globalStatusConstant,function(t){return a("el-option",{key:t.value,attrs:{label:t.title,value:t.value}})}),1),t._v(" "),a("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"20px"},attrs:{type:"primary"},on:{click:t.handleSearch}},[t._v("搜索\n            ")])]:t._e()],2),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.listQuery.fid,expression:"listQuery.fid"}]},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],ref:"dataTable",staticClass:"active-table",staticStyle:{width:"100%"},attrs:{data:t.dataList,"element-loading-text":"加载中...",border:"",fit:""}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.row.branchList,"row-class-name":t.tableDangerousClassName,border:"",fit:""}},[a("el-table-column",{attrs:{label:"ID"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.id))])]}}],!0)}),t._v(" "),a("el-table-column",{attrs:{label:"开始时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("parseTime")(e.row.startAt)))])]}}],!0)}),t._v(" "),a("el-table-column",{attrs:{label:"状态"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("branch-status",{attrs:{item:t.row}})]}}],!0)})],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"left",label:"事务ID/分支条数",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.id)+"/"+t._s(e.row.branchList.length))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"事务名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.name))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"超时时间(毫秒)",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("toMsByNsFilter")(e.row.timeout)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"状态",width:"210px"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("global-status",{attrs:{item:t.row}})]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"开始时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("parseTime")(e.row.startAt)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"分支(phaseOne/PhaseTwo)"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.branchPhaseOne)+"/"+t._s(e.row.branchPhaseTwo))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"left",label:"操作",width:"320px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return t.handleShow(e.row)}}},[t._v("查看")]),t._v(" "),e.row.branchList.length>0?[e.row.branchOpen?[a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(a){return t.handleToggleBranch(e.row)}}},[t._v("收起分支\n                            ")])]:[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.handleToggleBranch(e.row)}}},[t._v("展开分支\n                            ")])]]:t._e(),t._v(" "),e.row.statusFinal?t._e():[a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return t.handleRollback(e.row)}}},[t._v("回滚")]),t._v(" "),e.row.isAllBranchSuccess?[a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(a){return t.handleSubmit(e.row)}}},[t._v("提交")])]:t._e()]]}}])})],1),t._v(" "),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{background:"","current-page":t.listQuery.page,"page-sizes":[1,10,20,30,50],"page-size":t.listQuery.size,layout:"sizes, prev, pager, next, jumper"},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){return t.$set(t.listQuery,"page",e)},"update:current-page":function(e){return t.$set(t.listQuery,"page",e)}}})],1)],1)])},[],!1,null,"0b4cf629",null);e.default=b.exports},hZMg:function(t,e,a){"use strict";a.d(e,"a",function(){return s});var n=a("t3Un");function s(){return Object(n.a)({url:"/fragments",method:"GET"})}},j6lA:function(t,e,a){"use strict";a.d(e,"a",function(){return s}),a.d(e,"b",function(){return i});var n=a("JDVc");function s(t){var e={id:t.id,name:t.n,timeout:t.t,creator:t.c,startAt:t.s,status:t.st,proxy:t.p,action:t.a,branchList:function(t){var e=[];return(t=t||[]).forEach(function(t){var a={id:t.id,gid:t.g,rmsId:t.r,resource:t.rs,lockKeyList:t.l,startAt:t.s,status:t.st},s=[n.e.Unknown,n.e.PhaseOneFailed,n.e.PhaseOneTimeout,n.e.PhaseTwoCommitFailedUnretriable,n.e.PhaseTwoRollbackFailedUnretriable],i=[n.e.PhaseTwoCommitFailedRetriable,n.e.PhaseTwoRollbackFailedRetriable];s.includes(a.status)?a.statusDangerous=!0:i.includes(a.status)&&(a.statusWarning=!0),[n.e.PhaseTwoCommitted].includes(a.status)&&(a.statusSuccess=!0),e.push(a)}),e}(t.bs),branchOpen:!1,branchRegistered:0,branchPhaseOne:0,branchPhaseTwo:0},a=0,s=0,i=0,r=0;e.branchList.forEach(function(t){var e=function(t){var e;1===t?e=n.c.Registered:t>1&&t<5?e=n.c.PhaseOne:t>4&&(e=n.c.PhaseTwo);return e}(t.status);e===n.c.Registered?a+=1:e===n.c.PhaseTwo?i+=1:e===n.c.PhaseOne&&(s+=1),t.statusSuccess&&(r+=1)});var l=[n.h.Committed,n.h.CommitFailed,n.h.Rollbacked,n.h.RollbackFailed,n.h.RollbackedSinceTimeout,n.h.RollbackFailedSinceTimeout,n.h.Finished],o=[n.h.RetryCommitting,n.h.CommitFailed,n.h.RollbackFailed],u=[n.h.RollbackingSinceTimeout,n.h.RetryRollbackingSinceTimeout,n.h.RollbackedSinceTimeout,n.h.RollbackFailedSinceTimeout],c=[n.h.Committed];return l.includes(e.status)&&(e.statusFinal=!0),o.includes(e.status)?e.statusDangerous=!0:u.includes(e.status)?e.statusWarning=!0:c.includes(e.status)&&(e.statusSuccess=!0),e.branchRegistered=a,e.branchPhaseOne=s,e.branchPhaseTwo=i,e.isAllBranchSuccess=r===e.branchList.length,e}function i(t){var e=[];return(t=t||[]).forEach(function(t){var a=s(t);e.push(a)}),e}},jUE0:function(t,e,a){},pr5Q:function(t,e,a){"use strict";a.d(e,"c",function(){return l}),a.d(e,"b",function(){return o}),a.d(e,"d",function(){return u}),a.d(e,"a",function(){return c});var n=a("t3Un"),s=a("7Qib"),i="/fragments/",r="/transactions";function l(t){var e={limit:t.size||10};return t.id&&(e.after=t.id),t.name&&(e.name=t.name),!Object(s.b)(t.name)&&t.name&&(e.name=t.name),Object(s.b)(t.status)||(e.status=t.status),Object(s.b)(t.action)||(e.action=t.action),Object(n.a)({url:i+t.fid+r,method:"GET",params:e})}function o(t,e){return!(!e||!t)&&Object(n.a)({url:i+t+r+"/"+e,method:"GET"})}function u(t,e){return!(!e||!t)&&Object(n.a)({url:i+t+r+"/"+e+"/rollback",method:"PUT"})}function c(t,e){return!(!e||!t)&&Object(n.a)({url:i+t+r+"/"+e+"/commit",method:"PUT"})}},t3Un:function(t,e,a){"use strict";var n=a("4d7F"),s=a.n(n),i=a("vDqi"),r=a.n(i),l=a("XJYT"),o=r.a.create({baseURL:"/v1",timeout:6e4});o.interceptors.request.use(function(t){return t},function(t){console.error(t),s.a.reject(t)}),o.interceptors.response.use(function(t){var e=t.data||{};t.headers;return 0===e.code?e.value:(Object(l.Message)({message:e.message,type:"error",duration:5e3}),s.a.reject("error"))},function(t){return Object(l.Message)({message:t.data||"网络异常",type:"error",duration:5e3}),s.a.reject(t)}),e.a=o}}]);